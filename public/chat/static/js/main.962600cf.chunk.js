(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{14:function(e,n,t){},15:function(e,n,t){},18:function(e,n,t){"use strict";t.r(n);var s,u=t(1),r=t.n(u),c=t(8),a=t.n(c),i=(t(14),t(9)),o=t(4),l=(t(15),t(2)),b=t.n(l),f=t(6);function d(e){switch(e.type){case s.Subscribe:return function(e){var n,t="".concat(s.Subscribe);if(!(null===(n=e.subjects)||void 0===n?void 0:n.length))return null;return e.subjects.forEach((function(e){t+=" "+e})),t+="\n"}(e);case s.Unsubscribe:return function(e){var n,t="".concat(s.Unsubscribe);if(!(null===(n=e.subjects)||void 0===n?void 0:n.length))return null;return e.subjects.forEach((function(e){t+=" "+e})),t+="\n"}(e);case s.Request:return function(e){var n,t,u,r="".concat(s.Request," ");if(!e.uri)return null;if(r+=e.uri+" ",!e.inbox)return null;return r+=e.inbox+" ",r+=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.length)&&void 0!==n?n:0,r+="\n",r+=null!==(u=e.payload)&&void 0!==u?u:""}(e);case s.Response:return function(e){var n,t,u,r="".concat(s.Response," ");if(!e.uri)return null;if(r+=e.uri+" ",!e.inbox)return null;return r+=e.inbox+" ",r+=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.length)&&void 0!==n?n:0,r+="\n",r+=null!==(u=e.payload)&&void 0!==u?u:""}(e);case s.Publish:return function(e){var n,t,u="".concat(s.Publish," ");if(!e.subject)return null;return u+=e.subject+" ",u+=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.length)&&void 0!==n?n:0,u+="\n",u+=e.payload}(e)}}!function(e){e.Subscribe="SUB",e.Unsubscribe="UNSUB",e.Request="REQ",e.Response="RSP",e.Publish="PUB"}(s||(s={}));var j=t(20);function v(e){var n=new WebSocket(e),t=new Promise((function(e){n.readyState===n.OPEN?e(void 0):n.onopen=e}));function u(){return(u=Object(f.a)(b.a.mark((function e(s){var u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:null!==(u=d(s))&&n.send(u);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{send:function(e){return u.apply(this,arguments)},addMessageEventListener:function(e){n.addEventListener("message",(function(n){var t=function(e){var n=e.split("\n");if(n.length<=1)return null;var t=n[0].split(" "),u=t[0],r={type:u};switch(t=t.slice(1),u){case s.Subscribe:case s.Unsubscribe:r.subjects=t;break;case s.Request:case s.Response:r.uri=t[0],r.inbox=t[1];break;case s.Publish:r.subject=t[0]}var c=n.slice(1).join("\n");return r.payload=c,r}(n.data);null!==t&&e(t)}))}}}function p(e){var n=v(e),t=function(e){var n={};function t(){return(t=Object(f.a)(b.a.mark((function t(u,r){var c,a,i,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=Object(j.a)(),a={type:s.Request,uri:u,inbox:c,payload:JSON.stringify(null!==r&&void 0!==r?r:{})},i=new Promise((function(e){n[c]=e})),e.send(a),t.next=6,i;case 6:if((o=t.sent).payload){t.next=9;break}return t.abrupt("return",null);case 9:return t.abrupt("return",JSON.parse(o.payload));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return e.addMessageEventListener((function(e){if(e.type===s.Response&&e.inbox){var t=n[e.inbox];t&&(t(e),delete n[e.inbox])}})),{request:function(e,n){return t.apply(this,arguments)},close:function(){}}}(n),u=function(e){var n={};return e.addMessageEventListener((function(e){if(e.type===s.Publish&&e.subject){var t=n[e.subject];t&&e.payload&&t(JSON.parse(e.payload))}})),{subscribe:function(t,u){n[t]=u,e.send({type:s.Subscribe,subjects:[t]})},unsubscribe:function(t){e.send({type:s.Unsubscribe,subjects:[t]}),delete n[t]},close:function(){}}}(n);return{request:t.request,subscribe:u.subscribe,close:function(){t.close(),u.close()}}}var h=t(0);function O(e){return"mantil-project-chat-chat.".concat(e)}function m(e){var n=e.messages,t=Object(u.useRef)(null);return Object(u.useEffect)((function(){!function(){var e;null===(e=t.current)||void 0===e||e.scrollIntoView()}()}),[n]),Object(h.jsxs)("div",{className:"messages",children:[n.map((function(e){return Object(h.jsxs)("div",{className:"message",children:[Object(h.jsx)("div",{className:"user",children:e.user}),Object(h.jsx)("div",{className:"content",children:e.content})]},e.id)})),Object(h.jsx)("div",{ref:t})]})}function x(e){var n=e.api,t=e.username,s=Object(u.useState)(""),r=Object(o.a)(s,2),c=r[0],a=r[1],i=Object(u.useCallback)((function(e){"Enter"===e.key&&(n.request(O("add"),{message:{user:t,content:c}}),a(""))}),[c,n]),l=Object(u.useRef)(null);return Object(u.useEffect)((function(){var e;null===(e=l.current)||void 0===e||e.focus()}),[]),Object(h.jsx)("input",{ref:l,className:"input",type:"text",value:c,onChange:function(e){return a(e.target.value)},onKeyDown:i})}function y(e){var n=e.setUsername,t=Object(u.useState)(""),s=Object(o.a)(t,2),r=s[0],c=s[1],a=Object(u.useCallback)((function(e){"Enter"===e.key&&n(r)}),[n,r]);return Object(h.jsxs)("div",{className:"user-prompt",children:["Enter your username:",Object(h.jsx)("input",{className:"user-input",type:"text",value:r,onChange:function(e){return c(e.target.value)},onKeyPress:a})]})}var g=function(){var e=Object(u.useState)([]),n=Object(o.a)(e,2),t=n[0],s=n[1],r=Object(u.useMemo)((function(){return p("wss://uaejc9t3ga.execute-api.eu-central-1.amazonaws.com/$default")}),[]);Object(u.useEffect)((function(){r.subscribe("chat-messages",(function(e){s((function(n){return[].concat(Object(i.a)(n),[e])}))})),r.request(O("get"),null).then((function(e){s(e.messages)}))}),[]);var c=Object(u.useState)(""),a=Object(o.a)(c,2),l=a[0],b=a[1];return Object(h.jsx)("div",{className:"App",children:Object(h.jsx)("div",{className:"chat",children:""===l?Object(h.jsx)(y,{setUsername:b}):Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(m,{messages:t}),Object(h.jsx)(x,{api:r,username:l})]})})})},S=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,21)).then((function(n){var t=n.getCLS,s=n.getFID,u=n.getFCP,r=n.getLCP,c=n.getTTFB;t(e),s(e),u(e),r(e),c(e)}))};a.a.render(Object(h.jsx)(r.a.StrictMode,{children:Object(h.jsx)(g,{})}),document.getElementById("root")),S()}},[[18,1,2]]]);
//# sourceMappingURL=main.962600cf.chunk.js.map