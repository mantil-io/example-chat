(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{17:function(e,n,t){},18:function(e,n,t){},21:function(e,n,t){"use strict";t.r(n);var s,r=t(3),c=t.n(r),u=t(11),a=t.n(u),i=(t(17),t(12)),o=t(7),l=(t(18),t(4)),b=t.n(l),d=t(9);function f(e){switch(e.type){case s.Subscribe:return function(e){var n,t="".concat(s.Subscribe);if(!(null===(n=e.subjects)||void 0===n?void 0:n.length))return null;return e.subjects.forEach((function(e){t+=" "+e})),t+="\n"}(e);case s.Unsubscribe:return function(e){var n,t="".concat(s.Unsubscribe);if(!(null===(n=e.subjects)||void 0===n?void 0:n.length))return null;return e.subjects.forEach((function(e){t+=" "+e})),t+="\n"}(e);case s.Request:return function(e){var n,t,r,c="".concat(s.Request," ");if(!e.uri)return null;if(c+=e.uri+" ",!e.inbox)return null;return c+=e.inbox+" ",c+=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.length)&&void 0!==n?n:0,c+="\n",c+=null!==(r=e.payload)&&void 0!==r?r:""}(e);case s.Response:return function(e){var n,t,r,c="".concat(s.Response," ");if(!e.uri)return null;if(c+=e.uri+" ",!e.inbox)return null;return c+=e.inbox+" ",c+=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.length)&&void 0!==n?n:0,c+="\n",c+=null!==(r=e.payload)&&void 0!==r?r:""}(e);case s.Publish:return function(e){var n,t,r="".concat(s.Publish," ");if(!e.subject)return null;return r+=e.subject+" ",r+=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.length)&&void 0!==n?n:0,r+="\n",r+=e.payload}(e)}}!function(e){e.Subscribe="SUB",e.Unsubscribe="UNSUB",e.Request="REQ",e.Response="RSP",e.Publish="PUB"}(s||(s={}));var j=t(25);function v(e){var n=new WebSocket(e),t=new Promise((function(e){n.readyState===n.OPEN?e(void 0):n.onopen=e}));function r(){return(r=Object(d.a)(b.a.mark((function e(s){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:null!==(r=f(s))&&n.send(r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{send:function(e){return r.apply(this,arguments)},addMessageEventListener:function(e){n.addEventListener("message",(function(n){var t=function(e){var n=e.split("\n");if(n.length<=1)return null;var t=n[0].split(" "),r=t[0],c={type:r};switch(t=t.slice(1),r){case s.Subscribe:case s.Unsubscribe:c.subjects=t;break;case s.Request:case s.Response:c.uri=t[0],c.inbox=t[1];break;case s.Publish:c.subject=t[0]}var u=n.slice(1).join("\n");return c.payload=u,c}(n.data);null!==t&&e(t)}))}}}function p(e){if(!e&&mantilEnv&&(e=mantilEnv.endpoints.ws),!e)throw"No WebSocket URL provided.";var n=v(e),t=function(e){var n={};function t(){return(t=Object(d.a)(b.a.mark((function t(r,c){var u,a,i,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=Object(j.a)(),a={type:s.Request,uri:r,inbox:u,payload:JSON.stringify(null!==c&&void 0!==c?c:{})},i=new Promise((function(e){n[u]=e})),e.send(a),t.next=6,i;case 6:if((o=t.sent).payload){t.next=9;break}return t.abrupt("return",null);case 9:return t.abrupt("return",JSON.parse(o.payload));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return e.addMessageEventListener((function(e){if(e.type===s.Response&&e.inbox){var t=n[e.inbox];t&&(t(e),delete n[e.inbox])}})),{request:function(e,n){return t.apply(this,arguments)},close:function(){}}}(n),r=function(e){var n={};return e.addMessageEventListener((function(e){if(e.type===s.Publish&&e.subject){var t=n[e.subject];t&&e.payload&&t(JSON.parse(e.payload))}})),{subscribe:function(t,r){n[t]=r,e.send({type:s.Subscribe,subjects:[t]})},unsubscribe:function(t){e.send({type:s.Unsubscribe,subjects:[t]}),delete n[t]},close:function(){}}}(n);return{request:t.request,subscribe:r.subscribe,close:function(){t.close(),r.close()}}}var h=t(26),O=t(24),m=t(1);function x(e){return"chat.".concat(e)}function y(e){var n=e.messages,t=Object(r.useRef)(null);Object(r.useEffect)((function(){!function(){var e;null===(e=t.current)||void 0===e||e.scrollIntoView()}()}),[n]);return Object(m.jsxs)("div",{className:"messages",children:[n.map((function(e){return Object(m.jsxs)("div",{className:"message",children:[Object(m.jsxs)("div",{className:"info-row",children:[Object(m.jsx)("div",{className:"user",children:e.user}),Object(m.jsx)("div",{className:"time",children:(n=e,Object(h.a)(new Date,new Date(n.createdAt))>=1?Object(O.a)(new Date(n.createdAt),"M.d. H:mm:ss"):Object(O.a)(new Date(n.createdAt),"H:mm:ss"))})]}),Object(m.jsx)("div",{className:"content",children:e.content})]},e.id);var n})),Object(m.jsx)("div",{ref:t})]})}function g(e){var n=e.api,t=e.username,s=Object(r.useState)(""),c=Object(o.a)(s,2),u=c[0],a=c[1],i=Object(r.useCallback)((function(e){"Enter"===e.key&&(n.request(x("add"),{message:{user:t,content:u}}),a(""))}),[u,n]),l=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e;null===(e=l.current)||void 0===e||e.focus()}),[]),Object(m.jsx)("input",{ref:l,className:"input",type:"text",value:u,onChange:function(e){return a(e.target.value)},onKeyDown:i})}function w(e){var n=e.setUsername,t=Object(r.useState)(""),s=Object(o.a)(t,2),c=s[0],u=s[1],a=Object(r.useCallback)((function(e){"Enter"===e.key&&n(c)}),[n,c]);return Object(m.jsxs)("div",{className:"user-prompt",children:["Enter your username:",Object(m.jsx)("input",{className:"user-input",type:"text",value:c,onChange:function(e){return u(e.target.value)},onKeyPress:a})]})}var S=function(){var e=Object(r.useState)([]),n=Object(o.a)(e,2),t=n[0],s=n[1],c=Object(r.useMemo)((function(){return p()}),[]);Object(r.useEffect)((function(){c.subscribe("chat-messages",(function(e){s((function(n){return[].concat(Object(i.a)(n),[e])}))})),c.request(x("get"),null).then((function(e){s(e.messages)}))}),[]);var u=Object(r.useState)(""),a=Object(o.a)(u,2),l=a[0],b=a[1];return Object(m.jsx)("div",{className:"App",children:Object(m.jsx)("div",{className:"chat",children:""===l?Object(m.jsx)(w,{setUsername:b}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(y,{messages:t}),Object(m.jsx)(g,{api:c,username:l})]})})})},E=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,27)).then((function(n){var t=n.getCLS,s=n.getFID,r=n.getFCP,c=n.getLCP,u=n.getTTFB;t(e),s(e),r(e),c(e),u(e)}))};a.a.render(Object(m.jsx)(c.a.StrictMode,{children:Object(m.jsx)(S,{})}),document.getElementById("root")),E()}},[[21,1,2]]]);
//# sourceMappingURL=main.9faeadb9.chunk.js.map